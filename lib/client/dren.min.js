/**
 * @file Main client-side framework file
 * @description Client-side functions
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license https://raw.githubusercontent.com/iThoughts-Informatique/DREN.js/master/LICENSE GPL-3.0
 * @package dren.js
 *
 * @namespace client
 *
 * @version 0.0.2
 */
!function(t,e){"use strict";function n(){var t=s===a-1?o:n;console.log(i[s],s),requirejs(i[s],t),s++}function o(){var t=window.DRENjs,e=window.iThoughts_Toolbox;t.init(e)}var i=[["/js/ithoughts-toolbox.js"]].concat(t.initDeps),s=0,a=i.length;n(),t.Methods={POST:1,GET:2,PUT:4,DELETE:8},t.loadPage=function(n,o,i,s){return o=o.toUpperCase(),e.isNA(t.Methods[o])?void console.error("Trying to use unknown method "+o):(console.info("Accessing url "+n+" via "+o),history.pushState({},null,n),void t.sendRequest[o.toUpperCase()](n,i,function(n,o){switch(console.log(n,o),o.statusCode){case 200:if(!e.isNA(n)&&n&&"Object"==n.constructor.name){n.head;var i=n.content;if(!e.isNA(i))if("object"==typeof i){for(var a in i)if(e.hop(i,a)){var r=i[a],c=t.scriptsIniters[a],l=t.domElements.areas[a];e.isNA(c)||c.unload&&c.unload(l,e),"object"==typeof r?(l.innerHTML=r.html,l.setAttribute("data-containing",r.template_name)):l.innerHTML=r,l.templateInited=void 0}}else"string"==typeof i?(t.domElements.areas.content.innerHTML=i,t.domElements.areas.content.templateInited=void 0):console.log("Not catched")}break;case 404:}e.isNA(s)||s.apply(n),t.init()}))},t.scriptsIniters={},t.init=function(n){!e&&n&&(e=n);var o={head:{title:e.qs("title"),description:e.qs('meta[name="description"]')},links:[].slice.call(e.qsa('a[drenjs][href^="/"]')),areas:[].reduce.call(e.qsa("[data-content-area]"),function(t,e,n){return t[e.getAttribute("data-content-area")]=e,t},{}),templates:[].reduce.call(e.qsa("[data-containing]"),function(t,e,n){return t[e.getAttribute("data-containing")]=e,t},{})};t.domElements=o,console.log(o.templates);var i=o.links.filter(function(t){return t.boundLink^(t.boundLink=!0)});if(i.length&&console.log("Bonding new links:",i),e.on(i,["click"],function(e){return e.preventDefault(),t.loadPage(e.target.href,"GET",null),!1}),!e.isNA(t.template_scripts)){var s={};Object.keys(o.templates).filter(function(t){return o.templates[t].templateInited^(o.templates[t].templateInited=!0)}).forEach(function(t){s[t]=o.templates[t]}),Object.keys(s).length&&console.log("Initing new templates:",s);for(var a in s)if(s.hasOwnProperty(a)){var r=t.template_scripts[a];console.log("Requiring ",r),r.constructor!==[]&&(r=[r],console.log("Force cast to array")),r&&requirejs(r,function(){for(var n=0,o=arguments.length;o>n;n++){var i=arguments[n];"function"==typeof i?i(s[a],e):"object"==typeof i?(t.scriptsIniters[a]=i,i.load?i.load(s[a],e):console.error("Not catched")):console.error("Not catched")}})}}t.postInit&&t.postInit()}}(window.DRENjs||(window.DRENjs={}));